---
title: 'RAG学习笔记'
pubDate: '2025-12-11'
---

# 引子

在L站上看见一位大佬发的帖子说RAG里面有蛮多讲究的, 然后还提到一点是AI强而不是RAG强, 其实我觉得这就是涉及到一个本地和云端的差距吧, 你像那种大企业, 例如国企那种, 可能不会轻易的把自己什么私密数据上传到云端的.

他们想要用RAG估计只能本地部署, 那位大佬说的是AI强, 可以自己回答一些RAG里面没有的东西, 其实也是正确的, 毕竟AI喂的语料太多了, 基本上你问啥他都能回答上来, 所以我有一个结论: 

**大多数RAG适合服务于企业内部, 而非消费者层级**

所以我自己也想来看看RAG到底是怎么一回事, 也算是记录一下自己的学习吧.

# 模块化

RAG（Retrieval-Augmented Generation）系统在实际工程中远比“检索 + 生成”两个模块复杂，完整的 RAG pipeline 一般包含 7 大核心模块 + 5 个增强模块。

Data Ingestion, Document Parsing, Chunking, Embedding, Vector Store, Retriever, LLM.
Query Reformulation, Reranking, Prompt Orchestration, Guardrails, Feedback & Evaluation.

<svg
  width="752"
  height="451.2"
  viewBox="0 0 1000 600"
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L8,3 L0,6 z" fill="#555" />
    </marker>
    <style>{`
      .box { fill:#ffffff; stroke:#333; stroke-width:1.1; }
      .title { font-family:system-ui,sans-serif; font-size:16px; font-weight:bold; fill:#111; }
      .text { font-family:system-ui,sans-serif; font-size:12px; fill:#03a9f4; }
      .small { font-family:system-ui,sans-serif; font-size:11px; fill:#03a9f4; }
      .label { font-family:system-ui,sans-serif; font-size:12px; fill:#111; }
      .section-title { font-family:system-ui,sans-serif; font-size:14px; font-weight:bold; fill:#222; }
      .dashed { stroke-dasharray:5 4; }
    `}</style>
  </defs>

  <rect x="0" y="0" width="1000" height="600" fill="#f7f7f7"/>

  <text class="section-title" x="140" y="40" text-anchor="middle">离线：知识库构建（数据 → 向量索引）</text>

  <rect class="box" x="20" y="60" width="120" height="110"/>
  <text class="title" x="80" y="85" text-anchor="middle">数据源</text>
  <text class="small" x="80" y="105" text-anchor="middle">· 文档 / PDF</text>
  <text class="small" x="80" y="122" text-anchor="middle">· 网页 / API</text>
  <text class="small" x="80" y="139" text-anchor="middle">· 内部系统</text>

  <rect class="box" x="170" y="60" width="140" height="80"/>
  <text class="title" x="240" y="85" text-anchor="middle">数据采集</text>
  <text class="small" x="240" y="105" text-anchor="middle">爬虫 / 同步 / 定时任务</text>

  <rect class="box" x="340" y="60" width="140" height="80"/>
  <text class="title" x="410" y="85" text-anchor="middle">文档解析</text>
  <text class="small" x="410" y="105" text-anchor="middle">提取正文、表格、OCR</text>

  <rect class="box" x="510" y="60" width="140" height="80"/>
  <text class="title" x="580" y="85" text-anchor="middle">文档切片</text>
  <text class="small" x="580" y="105" text-anchor="middle">按段落 / 长度分块</text>

  <rect class="box" x="680" y="60" width="140" height="80"/>
  <text class="title" x="750" y="85" text-anchor="middle">Embedding</text>
  <text class="small" x="750" y="105" text-anchor="middle">将 chunk → 向量</text>

  <rect class="box" x="850" y="50" width="130" height="100"/>
  <text class="title" x="915" y="75" text-anchor="middle">向量数据库</text>
  <text class="small" x="915" y="95" text-anchor="middle">FAISS / Milvus /</text>
  <text class="small" x="915" y="112" text-anchor="middle">Pinecone 等</text>

  <line x1="140" y1="100" x2="170" y2="100" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <line x1="310" y1="100" x2="340" y2="100" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <line x1="480" y1="100" x2="510" y2="100" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <line x1="650" y1="100" x2="680" y2="100" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <line x1="820" y1="100" x2="850" y2="100" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>

  <line x1="10" y1="180" x2="990" y2="180" stroke="#bbb" stroke-width="1" class="dashed"/>
  <text class="section-title" x="220" y="205" text-anchor="middle">在线：用户问答流程</text>

  <rect class="box" x="40" y="230" width="140" height="80"/>
  <text class="title" x="110" y="255" text-anchor="middle">用户</text>
  <text class="text" x="110" y="275" text-anchor="middle">问题 / 指令</text>

  <line x1="180" y1="270" x2="240" y2="270" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <text class="label" x="210" y="255" text-anchor="middle">提问</text>

  <rect class="box" x="240" y="230" width="160" height="80"/>
  <text class="title" x="320" y="253" text-anchor="middle">查询重写</text>
  <text class="small" x="320" y="273" text-anchor="middle">标准化 / 展开 query</text>

  <line x1="400" y1="270" x2="460" y2="270" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <text class="label" x="430" y="255" text-anchor="middle">检索请求</text>

  <rect class="box" x="460" y="210" width="220" height="120"/>
  <text class="title" x="570" y="235" text-anchor="middle">检索 & 重排</text>
  <text class="small" x="570" y="255" text-anchor="middle">1. 向量检索 / Hybrid Search</text>
  <text class="small" x="570" y="272" text-anchor="middle">2. Rerank 提升相关性</text>
  <text class="small" x="570" y="292" text-anchor="middle">3. 选出 Top-k 文档片段</text>

  <line x1="570" y1="210" x2="915" y2="150" stroke="#999" stroke-width="1.1" marker-end="url(#arrow)"/>
  <text class="small" x="750" y="188" text-anchor="middle">相似度检索</text>

  <line x1="680" y1="270" x2="740" y2="270" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <text class="label" x="710" y="255" text-anchor="middle">检索到的上下文</text>

  <rect class="box" x="740" y="230" width="200" height="80"/>
  <text class="title" x="840" y="253" text-anchor="middle">Prompt 构建</text>
  <text class="small" x="840" y="273" text-anchor="middle">将“问题 + 文档片段”拼成</text>
  <text class="small" x="840" y="290" text-anchor="middle">LLM 输入（模板）</text>

  <line x1="840" y1="310" x2="840" y2="360" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <text class="label" x="860" y="340">请求</text>

  <rect class="box" x="720" y="360" width="240" height="120"/>
  <text class="title" x="840" y="385" text-anchor="middle">LLM 生成模块</text>
  <text class="small" x="840" y="405" text-anchor="middle">使用检索到的上下文进行回答</text>
  <text class="small" x="840" y="422" text-anchor="middle">可为：本地模型 / 云端 API</text>

  <line x1="720" y1="420" x2="180" y2="420" stroke="#555" stroke-width="1.3" marker-end="url(#arrow)"/>
  <text class="label" x="450" y="405" text-anchor="middle">答案返回给用户</text>

  <text class="small" x="110" y="410" text-anchor="middle">展示回答 / 对话</text>

  <line x1="10" y1="500" x2="990" y2="500" stroke="#bbb" stroke-width="1" class="dashed"/>
  <text class="section-title" x="150" y="525" text-anchor="middle">增强模块（提高质量 & 安全 & 可观测性）</text>

  <rect class="box" x="280" y="520" width="180" height="60"/>
  <text class="title" x="370" y="545" text-anchor="middle">Guardrails</text>
  <text class="small" x="370" y="565" text-anchor="middle">安全过滤 / 敏感内容 / 拒答策略</text>

  <rect class="box" x="520" y="520" width="200" height="60"/>
  <text class="title" x="620" y="545" text-anchor="middle">监控 & 评估</text>
  <text class="small" x="620" y="565" text-anchor="middle">日志、检索质量、用户反馈、A/B 测试</text>

  <line x1="720" y1="440" x2="460" y2="520" stroke="#999" stroke-width="1.1" class="dashed" marker-end="url(#arrow)"/>
  <text class="small" x="520" y="470" text-anchor="middle">对回答做安全 & 规则校验</text>

  <line x1="520" y1="520" x2="520" y2="330" stroke="#999" stroke-width="1.1" class="dashed" marker-end="url(#arrow)"/>
  <text class="small" x="495" y="360" text-anchor="end">采集日志 & 评估</text>
</svg>

用chat总结的一个表格, 简单来说, 就是类似于一个智能客服, 只不过你给他的语料决定了他回答的内容.

# Fine tune (微调)

这个部分应该是决定RAG的关键部分, 就是要加入合适的提示词来让他生成更加接近真人的回答吧, 不然一眼就能看出是AI回复了.
